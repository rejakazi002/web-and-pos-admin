<section class="page-header-section">
  <div class="page-header-card">
    <div class="header-content">
      <div class="header-title">
        <h1 class="page-title">
          <mat-icon class="title-icon">today</mat-icon>
          Daily Sale Report
        </h1>
      </div>
    </div>
  </div>
</section>

<section class="filter-section">
  <div class="filter-card">
    <div class="filter-content">
      <mat-form-field appearance="outline">
        <mat-label>Select Date</mat-label>
        <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate" (dateChange)="onDateChange()">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>
    <div class="export-toolbar" *ngIf="!isLoading && reportData">
      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportCSV()"
        matTooltip="Export CSV">
        <mat-icon>description</mat-icon>
        <span>Export CSV</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportExcel()"
        matTooltip="Export Excel">
        <mat-icon>table_chart</mat-icon>
        <span>Export Excel</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="printReport()"
        matTooltip="Print">
        <mat-icon>print</mat-icon>
        <span>Print</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="showColumnsInfo()"
        matTooltip="Columns">
        <mat-icon>view_column</mat-icon>
        <span>Columns</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportPDF()"
        matTooltip="Export PDF">
        <mat-icon>picture_as_pdf</mat-icon>
        <span>Export PDF</span>
      </button>
    </div>
  </div>
</section>

<app-page-loader *ngIf="isLoading"></app-page-loader>

<section class="content-section" *ngIf="!isLoading && reportData">
  <div class="report-card">
    <h2>Daily Sale Report - {{ selectedDate | date:'longDate' }}</h2>
    
    <div class="summary-grid">
      <div class="summary-item highlight">
        <h4>Total Sales</h4>
        <p class="large">{{ reportData.summary.totalSales || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
      <div class="summary-item">
        <h4>Total Transactions</h4>
        <p>{{ reportData.summary.totalTransactions || 0 }}</p>
      </div>
      <div class="summary-item">
        <h4>Total Paid</h4>
        <p class="positive">{{ reportData.summary.totalPaid || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
      <div class="summary-item">
        <h4>Total Due</h4>
        <p class="negative">{{ reportData.summary.totalDue || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
      <div class="summary-item">
        <h4>Cash Sales</h4>
        <p>{{ reportData.summary.cashSales || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
      <div class="summary-item">
        <h4>Card Sales</h4>
        <p>{{ reportData.summary.cardSales || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
      <div class="summary-item">
        <h4>Total Discount</h4>
        <p>{{ reportData.summary.totalDiscount || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
      <div class="summary-item">
        <h4>Total VAT</h4>
        <p>{{ reportData.summary.totalVat || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
      <div class="summary-item">
        <h4>Repair Amount</h4>
        <p>{{ reportData.summary.totalRepairAmount || 0 | currency:'BDT ':'symbol':'1.2-2' }}</p>
      </div>
    </div>

    <div class="hourly-section" *ngIf="reportData.hourlyBreakdown && reportData.hourlyBreakdown.length > 0">
      <h3>Hourly Breakdown</h3>
      <div class="table-responsive">
        <table class="modern-table">
          <thead>
            <tr>
              <th>Hour</th>
              <th>Sales</th>
              <th>Transactions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let hour of reportData.hourlyBreakdown">
              <td>{{ hour._id }}:00 - {{ hour._id + 1 }}:00</td>
              <td>{{ hour.sales | currency:'BDT ':'symbol':'1.2-2' }}</td>
              <td>{{ hour.count }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
